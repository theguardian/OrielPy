<%!
    import orielpy
    import json

    from orielpy import database
    myDB = database.DBConnection()
    logfile_json = {}
    
    counter = 0
    logfile_list = myDB.action("SELECT Program from logpaths ORDER BY Program COLLATE NOCASE")
    for log in logfile_list:
        logfile_json[counter] = log['Program'] 
        counter+=1
    json_logfiles = json.dumps(logfile_json)
    
%>
<div class="configuration">
    <p id="general_header">[GENERAL]</p>  |  <p id="server_header">[SERVER]</p>  |  <p id="twitter_header">[TWITTER]</p>  |  <p id="notifications_header">[NOTIFICATIONS]</p>  |  <p id="logs_header">[LOGS]</p>
    <hr>
    <div id="config_general">
    <form action="generalUpdate" method="post">
    <table width="100%">
        <tr>
            <td>Server Name:</td>
            <td><input type="text" name="server_name" value="${orielpy.SERVER_NAME}" size="20" maxlength="40"></td>
            <td>Log Directory</td>
            <td><input type="text" name="logdir" value="${orielpy.LOGDIR}" size="40" maxlength="127"></td>
        </tr>
        <tr>
            <td>Broadcast Address:</td>
            <td><input type="text" name="http_host" value="${orielpy.HTTP_HOST}" size="15" maxlength="15"></td>
            <td>Broadcast Port:</td>
            <td><input type="text" name="http_port" value="${orielpy.HTTP_PORT}" size="5" maxlength="5"></td>
        </tr>
        <tr>
            <td>Username:</td>
            <td><input type="text" name="http_user" value="${orielpy.HTTP_USER}" size="20" maxlength="40"></td>
            <td>Password:</td>
            <td><input type="password" name="http_pass" value="${orielpy.HTTP_PASS}" size="20" maxlength="40"></td>
        </tr>
        <tr>
            <td>Theme:</td>
            <td>
            <select name="http_look">
                <option value="${orielpy.HTTP_LOOK}">${orielpy.HTTP_LOOK}</option>
            </select>
            </td>
            <td>Launch Browser:</td>
            <td>
                <%
                if orielpy.LAUNCH_BROWSER == 1:
                    checked = 'checked="checked"'
                else:
                    checked = ""
                %>
                <input type="checkbox" name="launch_browser" ${checked}>
            </td>
        </tr>
        <tr>
            <td>Notification Frequency:
            <BR>(Requires Restart)</td>
            <td><input type="text" name="notification_frequency" value="${orielpy.NOTIFICATION_FREQUENCY}" size="5" maxlength="5">
                <select name="notification_units">
                <%
                if orielpy.NOTIFICATION_UNITS == "hours":
                    selected = 'selected="selected"'
                else:
                    selected = ""
                %>
                <option value="hours" ${selected}>Hours</option>
                <%
                if orielpy.NOTIFICATION_UNITS == "minutes":
                    selected = 'selected="selected"'
                else:
                    selected = ""
                %>
                <option value="minutes" ${selected}>Minutes</option>
            </select>
            </td>

            <td>Notification on Nominal:</td>
            <td>
                <%
                if orielpy.NOTIFY_NOMINAL == 1:
                    checked = 'checked="checked"'
                else:
                    checked = ""
                %>
                <input type="checkbox" name="notify_nominal" ${checked}>
            </td>

        </tr>
        <tr><td colspan=4 align=right><input type="submit" value="Save Changes" /></td></tr>
    </table>
    </form>
    </div>

    <div id="config_server" style="display:none">
    <form action="serverUpdate" method="post">
    <table width="100%">
        <tr>
            <td>CPU Info Path:</td>
            <td><input type="text" name="cpu_info_path" value="${orielpy.CPU_INFO_PATH}" size="20" maxlength="40"></td>
            <td>Pseudofile Folder:</td>
            <td><input type="text" name="pseudofile_folder" value="${orielpy.PSEUDOFILE_FOLDER}" size="40" maxlength="127"></td>
        </tr>
        <tr>
            <td>CPU Thermal File:</td>
            <td><input type="text" name="cpu_temp_file" value="${orielpy.CPU_TEMP_FILE}" size="20" maxlength="40"></td>
            <td>SYS Thermal File:</td>
            <td><input type="text" name="sys_temp_file" value="${orielpy.SYS_TEMP_FILE}" size="20" maxlength="40"></td>
        </tr>
        <tr>
            <td>CPU Fan File:</td>
            <td><input type="text" name="cpu_fan_file" value="${orielpy.CPU_FAN_FILE}" size="20" maxlength="40"></td>
            <td>SYS Fan File:</td>
            <td><input type="text" name="sys_fan_file" value="${orielpy.SYS_FAN_FILE}" size="20" maxlength="40"></td>
        </tr>
        <tr>
            <td>CPU Thermal Range:</td>
            <td>
            <input type="text" name="cpu_temp_min" value="${orielpy.CPU_TEMP_MIN}" size="3" maxlength="3"> - 
            <input type="text" name="cpu_temp_max" value="${orielpy.CPU_TEMP_MAX}" size="3" maxlength="3"> Deg-C
            </td>
            <td>SYS Thermal Range:</td>
            <td>
                <input type="text" name="sys_temp_min" value="${orielpy.SYS_TEMP_MIN}" size="3" maxlength="3"> - <input type="text" name="sys_temp_max" value="${orielpy.SYS_TEMP_MAX}" size="3" maxlength="3"> Deg-C
            </td>
        </tr>
        <tr>
            <td>CPU Fan Range:</td>
            <td>
            <input type="text" name="cpu_fan_min" value="${orielpy.CPU_FAN_MIN}" size="5" maxlength="5"> - 
            <input type="text" name="cpu_fan_max" value="${orielpy.CPU_FAN_MAX}" size="5" maxlength="5"> RPM
            </td>
            <td>SYS Fan Range:</td>
            <td>
            <input type="text" name="sys_fan_min" value="${orielpy.SYS_FAN_MIN}" size="5" maxlength="5"> - 
            <input type="text" name="sys_fan_max" value="${orielpy.SYS_FAN_MAX}" size="5" maxlength="5"> RPM
            </td>
        </tr>
        <tr>
            <td>Internal Disk Rate:</td>
            <td><input type="text" name="internal_disk_max_rate" value="${orielpy.INTERNAL_DISK_MAX_RATE}" size="3" maxlength="3"> MB/s</td>
            <td>External Disk Rate:</td>
            <td><input type="text" name="external_disk_max_rate" value="${orielpy.EXTERNAL_DISK_MAX_RATE}" size="3" maxlength="3"> MB/s</td>
        </tr>
        <tr>
            <td>NIC Read Max:</td>
            <td><input type="text" name="nic_read_max" value="${orielpy.NIC_READ_MAX}" size="3" maxlength="3"> MB/s</td>
            <td>NIC Write Max:</td>
            <td><input type="text" name="nic_write_max" value="${orielpy.NIC_WRITE_MAX}" size="3" maxlength="3"> MB/s</td>
        </tr>
        <tr>
            <td>Num. Internal Disks:</td>
            <td><input type="text" name="num_internal_disk_capacity" value="${orielpy.NUM_INTERNAL_DISK_CAPACITY}" size="5" maxlength="2"> Disks</td>
        </tr>
        <tr><td colspan=4 align=right><input type="submit" value="Save Changes" /></td></tr>
    </table>
    </form>
    </div>

    <div id="config_twitter" style="display:none">
        <form action="notifyUpdate" method="post">
    <table width="100%">
        <tr>
            <td>Step One:</td><td>Step Two:</td><td>Step Three:</td>
            </tr>
        <tr>
            <td><input type="button" value="Request Authorization" id="twitterStep1" /></td>
            <td><input type="text" id="twitter_key" value="" size="20" />
            <input type="button" value="Verify Key" id="twitterStep2" />
        </td>
        <td>
        <input type="button" value="Test Twitter" id="testTwitter" />
        <input type="hidden" name="twitter_username" value="${orielpy.TWITTER_USERNAME}">
        <input type="hidden" name="twitter_password" value="${orielpy.TWITTER_PASSWORD}">
            </td>
            </tr>

            <tr>
            <td valign="top">Click the "Request Authorization" button.<br/> This will open a new page containing an auth key.<br/> Note: if nothing happens check your popup blocker.</td>
            <td valign="top">Enter the key Twitter gave you, and click "Verify Key".</td>
            <td valign="top">Click to test.</td>
        </tr>
        <tr>
                <td>
                <%
                if orielpy.USE_TWITTER == 1:
                    checked = 'checked="checked"'
                else:
                    checked = ""
                %>
                <input type="checkbox" name="use_twitter" ${checked} />
                    Enable Twitter
                </td><td></td>
                <td align="right"><input type="submit" value="Save Changes" /></td>
        </tr>
        </table>
    </form>
    </div>

    <div id="config_notifications" style="display:none">
        <form action="add_remove_rules" method="get">
        <table with="100%">
            <tr><td>Step 1:</td><td>Step 2:</td><td>Step 3:</td><td>Step 4:</td></tr>
            <tr>
            <td valign="top">
                <select name="rule1" id="choice1" onClick="change_Choice()">
                <option value="CPU Utilization" selected="selected">CPU Utilization</option>
                <option value="CPU Temperature">CPU Temperature</option>
                <option value="CPU Fan Speed">CPU Fan Speed</option>
                <option value="System Temperature">System Temperature</option>
                <option value="System Fan Speed">System Fan Speed</option>
                <option value="Network Rx Rate">Network Rx Rate</option>
                <option value="Network Tx Rate">Network Tx Rate</option>
                <option value="RAM Free Space">RAM Free Space</option>
                <option value="Swap Memory Free Space">Swap Memory Free Space</option>
                <option value="Volume Free Space">Volume Free Space</option>
                <option value="Disk Status">Disk Status</option>
                <option value="Log File">Log File</option>
            </select>
            <BR>
            <select name="rule2" id="choice2" style="display:none">
            </select>
            </td>
            <td valign="top">
                <select name="rule3" id="choice3">
                <option value="Is Less Than">Is Less Than</option>
                <option value="Is Greater Than">Is Greater Than</option>
            </select></td>
            <td valign="top">
                <input type="text" placeholder="Value" name="rule4" size="20" maxlength="255">
            <BR>
                <select name="rule5" id="choice5">
                <option value="Percent">Percent</option>
            </select></td>
            <td valign="top"><select name="rule6" id="choice6" onClick="show_Bubble()">
                <option value="Send Automated Message">Send Automated Message</option>
                <option value="Send Custom Message">Send Custom Message</option>
            </select>
            <BR>
                <input type="text" placeholder="The Custom Message" name="rule7" id="choice7" size="20" maxlength="255" style="display:none">
            </td>
            <td valign="top"><input type="hidden" name="action" value="addrule"><input type="submit" value="+Rule"></td>
           </tr>
           <tr><td colspan=5><hr></td></tr>
        </table>
        </form>

    <table width="100%">
    %for rule in rulelist:
        <%
        if rule['rule2']:
            rule2 = rule['rule2']
        else:
            rule2 = ""

        if rule['rule5']:
            rule5 = rule['rule5']
        else:
            rule5 = ""
        %>
        <tr>
            <td>${rule['rule1']}<BR>${rule2}</td><td>${rule['rule3']}</td><td>${rule['rule4']}<BR>${rule5}</td><td>${rule['rule6']}<BR>${rule['rule7']}</td>
            <td><form action="add_remove_rules" method="get">
            <input type="hidden" name="action" value="removerule">
            <input type="hidden" name="id_num" value="${rule['id_num']}">
            <input type="submit" value="Delete"></form></td>
        </tr>
    %endfor
    </table>
    </div>

    <div id="config_logs" style="display:none">
    <form action="add_remove_logs" method="get">
    <table width="100%">
        <tr>
            <td>Name:</td>
            <td><input type="text" placeholder="Program Name" name="program" size="20" maxlength="20"></td>
            <td>Path/To/Logfile.log:</td>
            <td><input type="text" placeholder="Path/To/Logfile.log" name="logpath" size="40" maxlength="255"></td>
            <input type="hidden" name="action" value="addlog">
            <td><input type="submit" value="Logfile"></td>
        </tr>
    </table>
    </form>
    <hr>
    <table width="100%">
    %for log in loglist:
        <tr>
            <td>${log['program']}</td><td>${log['logpath']}</td>
            <td><form action="add_remove_logs" method="get">
            <input type="hidden" name="action" value="removelog">
            <input type="hidden" name="program" value="${log['program']}">
            <input type="submit" value="Delete"></form></td>
        </tr>
    %endfor
    </table>
    </div>

    <div id="restart" style="display:none">

    </div>

    <div id="shutdown" style="display:none">

    </div>

</div>

<script type="text/javascript">

$(document).ready(function () {

    $("#general_header").click(function() {
        $("#config_general").show();
        $("#config_server").hide();
        $("#config_twitter").hide();
        $("#config_notifications").hide();
        $("#config_logs").hide();
        $("#config_restart").hide();
        $("#config_shutdown").hide();
    });

    $("#server_header").click(function() {
        $("#config_general").hide();
        $("#config_server").show();
        $("#config_twitter").hide();
        $("#config_notifications").hide();
        $("#config_logs").hide();
        $("#config_restart").hide();
        $("#config_shutdown").hide();
    });

    $("#twitter_header").click(function() {
        $("#config_general").hide();
        $("#config_server").hide();
        $("#config_twitter").show();
        $("#config_notifications").hide();
        $("#config_logs").hide();
        $("#config_restart").hide();
        $("#config_shutdown").hide();
    });

    $("#notifications_header").click(function() {
        $("#config_general").hide();
        $("#config_server").hide();
        $("#config_twitter").hide();
        $("#config_notifications").show();
        $("#config_logs").hide();
        $("#config_restart").hide();
        $("#config_shutdown").hide();
    });

    $("#logs_header").click(function() {
        $("#config_general").hide();
        $("#config_server").hide();
        $("#config_twitter").hide();
        $("#config_notifications").hide();
        $("#config_logs").show();
        $("#config_restart").hide();
        $("#config_shutdown").hide();
    });

    $("#restart_header").click(function() {
        $("#config_general").hide();
        $("#config_server").hide();
        $("#config_twitter").hide();
        $("#config_notifications").hide();
        $("#config_logs").hide();
        $("#config_restart").show();
        $("#config_shutdown").hide();
    });

    $("#shutdown_header").click(function() {
        $("#config_general").hide();
        $("#config_server").hide();
        $("#config_twitter").hide();
        $("#config_notifications").hide();
        $("#config_logs").hide();
        $("#config_restart").hide();
        $("#config_shutdown").show();
    });

    $('#twitterStep1').click(function () {
        $.get("twitterStep1", function (data) {window.open(data); })
            .done(function () { $('#testTwitter-result').html('<b>Step1:</b> Confirm Authorization'); });
    });

    $('#twitterStep2').click(function () {
        var twitter_key = $("#twitter_key").val();
        $.get("twitterStep2", {'key': twitter_key},
            function (data) { $('#testTwitter-result').html(data); });
    });

    $('#testTwitter').click(function () {
        $.get("testTwitter",
            function (data) { $('#testTwitter-result').html(data); });
    });

});

    function change_Choice() {
        selected_choice = $("#choice1").find("option:selected").text();
        $("#choice1").change(function() {
            selected_choice = $("#choice1").find("option:selected").text();
            $('#choice2').html('');
            if (selected_choice == "Log File") {
                $.each(${json_logfiles}, function(key, value) {
                    $('#choice2').append($("<option/>", {
                        value: value,
                        text: value
                    }));
                });
                $("#choice2").show();

                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Contains String",
                        text: "Contains String"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Does Not Contain String",
                        text: "Does Not Contain String"
                    }));
                $('#choice5').html('');
                $("#choice5").hide();
            }
            else if (selected_choice == "Disk Status") {
                json_disk = ${disk};
                json_ext = ${ext};
                $.each(json_disk, function(i, item) {
                    $('#choice2').append($("<option/>", {
                        value: json_disk[i].disk_id,
                        text: json_disk[i].disk_id
                    }));
                });
                $.each(json_ext, function(i, item) {
                    $('#choice2').append($("<option/>", {
                        value: json_ext[i].disk_id,
                        text: json_ext[i].disk_id
                    }));
                });
                $("#choice2").show();

                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is",
                        text: "Is"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Not",
                        text: "Is Not"
                    }));
                $('#choice5').html('');
                $("#choice5").hide();
            }
            else if (selected_choice == "Volume Free Space") {
                json_volumes = ${volumes};
                $.each(json_volumes, function(i, item) {
                    $('#choice2').append($("<option/>", {
                        value: json_volumes[i].mountpoint,
                        text: json_volumes[i].mountpoint
                    }));
                });
                $("#choice2").show();

                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "MB",
                        text: "MB"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "GB",
                        text: "GB"
                    }));
                $("#choice5").show();
            }
            else {
                $('#choice2').html('');
                $("#choice2").hide(); 
            }

            if (selected_choice == "CPU Utilization") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "CPU Temperature") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "Deg-C",
                        text: "Deg-C"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "System Temperature") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "Deg-C",
                        text: "Deg-C"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "CPU Fan Speed") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "RPM",
                        text: "RPM"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "System Fan Speed") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "RPM",
                        text: "RPM"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "Network Rx Rate") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "MB/s",
                        text: "MB/s"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "Network Tx Rate") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "MB/s",
                        text: "MB/s"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "RAM Free Space") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "MB",
                        text: "MB"
                    }));
                $("#choice5").show();
            }

            else if (selected_choice == "Swap Memory Free Space") {
                $('#choice3').html('');
                $('#choice3').append($("<option/>", {
                        value: "Is Less Than",
                        text: "Is Less Than"
                    }));
                $('#choice3').append($("<option/>", {
                        value: "Is Greater Than",
                        text: "Is Greater Than"
                    }));

                $('#choice5').html('');
                $('#choice5').append($("<option/>", {
                        value: "Percent",
                        text: "Percent"
                    }));
                $('#choice5').append($("<option/>", {
                        value: "MB",
                        text: "MB"
                    }));
                $("#choice5").show();
            }
        });
    }

    function show_Bubble() {
        selected_choice = $("#choice6").find("option:selected").text();
        $("#choice6").change(function() {
            selected_choice = $("#choice6").find("option:selected").text();
            $('#choice7').html('');
            if (selected_choice == "Send Custom Message") {
                $("#choice7").show();
            }
            else {
                $("#choice7").hide();
            }
        });
    }
</script>
